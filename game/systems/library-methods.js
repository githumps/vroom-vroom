    // Library System Methods - ADD THESE BEFORE endPrison() METHOD
    getBookLibrary() {
        return [
            {
                title: "Traffic Laws: A Bureaucratic History",
                pages: [
                    "CHAPTER 1: THE BEGINNING\n\nIn 1896, the first traffic law was enacted. It stated: 'A person shall not operate a horseless carriage faster than a man can walk.' This was sensible. This was reasonable.\n\nThen came the modifications. Amendment 1A. Subsection B-12. Form 77-Q. The law grew. It metastasized.",
                    "CHAPTER 2: THE FORMS\n\nForm TX-401: Intent to Operate Vehicle. Required 48 hours before driving. Filed in triplicate.\n\nForm TX-402: Post-Driving Report. Required within 6 hours of parking. Notarized.\n\nForm TX-403: Acknowledgment of TX-401 and TX-402. Required before TX-401. Yes, you read that correctly.",
                    "CHAPTER 3: THE ENFORCEMENT\n\nTraffic enforcement began with friendly constables on bicycles. They would wave. They would smile.\n\nNow there are surveillance cameras. License plate readers. Predictive algorithms. The system watches. It always watches. You cannot escape the system.",
                    "CHAPTER 4: THE PENALTIES\n\nFirst offense: Warning.\nSecond offense: Fine.\nThird offense: Prison.\n\nThese escalations seemed rational once. Now you sit in a cell for the crime of going to buy milk. The penalties have outpaced the crimes.",
                    "CHAPTER 5: THE PHILOSOPHY\n\nWhy do we punish drivers so harshly? Is it safety? Control? The answer is simpler:\n\nBecause we can.\n\nThe bureaucracy exists to perpetuate itself. You are fuel for the machine.",
                    "CHAPTER 6: THE RESISTANCE\n\nSome tried to fight back. They drove anyway. They tore up their forms. They refused to acknowledge the system.\n\nThey all ended up here. With you. In this cell. Reading this book.",
                    "CHAPTER 7: THE IRONY\n\nYou are reading a book about traffic laws in prison for violating traffic laws. The system has a sense of humor. Dark. Bureaucratic. But humor nonetheless.\n\nAre you laughing? Neither are we.",
                    "CHAPTER 8: THE FORMS (CONT.)\n\nForm TX-404: Request to Appeal TX-403.\nForm TX-405: Acknowledgment of TX-404 Denial.\nForm TX-406: Request to Acknowledge TX-405.\n\nIt never ends. The forms breed more forms. This is their nature.",
                    "CHAPTER 9: THE STATISTICS\n\n47,000 traffic regulations currently in effect.\n12,000 added last year.\n0 removed.\n\n3.2 million people in traffic-related prisons.\n15% of the entire population.\n\nYou are a statistic now.",
                    "CHAPTER 10: THE FUTURE\n\nWill it get better? No.\nWill it get worse? Yes.\nCan you stop it? No.\n\nThe only certainty is more forms. More laws. More cells.\n\nWelcome to the future. It looks exactly like now.",
                    "CHAPTER 11: THE APPEAL PROCESS\n\nYou may appeal your traffic conviction by filing Form AP-100 within 30 days. You will need:\n- Proof of innocence (impossible)\n- Three character witnesses (they're all in prison)\n- Court fee of $5,000 (you're in prison)\n\nThe appeal process exists to provide hope. False hope. But hope.",
                    "CHAPTER 12: THE ECONOMICS\n\nTraffic fines generated $4.2 billion last year.\nPrison labor from traffic offenders: $8.7 billion.\nTotal economic impact: immeasurable.\n\nYou are not a criminal. You are a revenue stream.",
                    "CHAPTER 13: THE PSYCHOLOGY\n\nWhy did you drive? Convenience? Necessity? Freedom?\n\nThe system doesn't care about your why. It only cares about your whether. You drove. That is enough.",
                    "CHAPTER 14: THE ALTERNATIVES\n\nPublic transportation: overcrowded, delayed, surveilled.\nWalking: exhausting, time-consuming, also surveilled.\nStaying home: lonely, impractical, eventually mandatory.\n\nThere are no good options. Only degrees of bad.",
                    "CHAPTER 15: THE LESSON\n\nWhat have you learned? That driving is wrong? That the law is just? That you deserved this?\n\nNo. You've learned that power needs no justification. That bureaucracy is self-sustaining. That you are small.\n\nClass dismissed.",
                    "CHAPTER 16: THE RECURSION\n\nThis book is about traffic laws. You're reading it because you broke traffic laws. By reading this, you're thinking about traffic laws. Which makes you more likely to break traffic laws again.\n\nThe system planned this. Every step. You never had a choice.",
                    "CHAPTER 17: THE HOPE\n\nThere is no hope.\n\nWait, we're required by prison regulations to include hope in educational materials.\n\nThere is mandated hope. Better?",
                    "CHAPTER 18: THE REALITY\n\nYou will finish this book.\nYou will serve your sentence.\nYou will be released.\nYou will drive again.\nYou will be arrested again.\n\nThis is not pessimism. This is pattern recognition.",
                    "CHAPTER 19: THE PHILOSOPHY (REVISITED)\n\nAre traffic laws evil? No. They're indifferent. Like gravity. Like entropy. Like the slow heat death of the universe.\n\nThey exist because they exist. That's all.",
                    "CHAPTER 20: THE END\n\nThank you for reading 'Traffic Laws: A Bureaucratic History.'\n\nYou have gained knowledge. It will not help you.\n\nYou have gained perspective. It will not free you.\n\nYou have gained time served. Finally, something useful.\n\nCongratulations, prisoner."
                ]
            },
            {
                title: "The Count of Monte Cristo (Excerpt)",
                pages: [
                    "Chapter 15: The Third Attack\n\n'But you had told me that you believed you were imprisoned unjustly.'\n\n'I believe so.'\n\n'Well, then, what crime have you committed?'\n\n'None that I know of. But perhaps I was condemned for being in the way of those who controlled the levers of power.'",
                    "'In prison,' said Dantès, 'one learns patience. In my case, I have learned it slowly, painfully, over years. But I have learned it. The walls teach patience. The stones teach endurance. The darkness teaches clarity.'",
                    "'Tell me,' asked the Abbé, 'what would you do if you were free?'\n\nEdmond thought for a long moment.\n\n'I would drive,' he said simply. 'Just drive. Anywhere. Nowhere. The destination would not matter. Only the motion. Only the freedom.'",
                    "'But freedom,' said the Abbé Faria, 'is not merely the absence of walls. It is the absence of fear. And I see in your eyes that you are still afraid.'\n\n'Afraid of what?' Dantès asked.\n\n'Of being imprisoned again. Of losing what little autonomy you have left.'",
                    "Dantès spent his days digging. Not to escape—he had long ago abandoned that hope—but to give his hands purpose. The tunnel went nowhere. It was metaphor made manifest.\n\nBut he dug anyway. Because doing nothing was worse than futile labor.",
                    "'They took everything from me,' Edmond said. 'My freedom. My love. My youth. What do I have left?'\n\n'Yourself,' the Abbé replied. 'The one thing they cannot take unless you give it freely. Hold onto that. Let everything else go.'",
                    "Time in prison moved strangely. Days felt like years. Years felt like moments. Dantès had been here for... how long? Five years? Ten? The count no longer mattered.\n\nWhat mattered was survival. Sanity. Small victories against the crushing weight of routine.",
                    "'Do you dream of revenge?' the Abbé asked one day.\n\n'No,' Dantès lied. 'I dream of breakfast. Of sunshine. Of roads that go somewhere. Revenge is too large a dream for this small cell.'",
                    "The guards came and went. They had names once, Edmond thought. Faces. Personalities. Now they were simply 'guard.' Interchangeable. Faceless. Like him.\n\nPrisoner #34. That's what they called him. He barely remembered his real name.",
                    "'Hope,' said the Abbé, 'is a dangerous thing in a place like this. It makes you vulnerable. It makes you weak. But without it, you are already dead.'\n\n'Then I choose weakness,' Edmond said. 'I choose vulnerability. I choose to hope anyway.'",
                    "They read together in the dim light filtering through the high window. Books were contraband, but the Abbé had ways. Old books. Forbidden books. Books about freedom and justice and worlds beyond these walls.",
                    "Edmond thought often of the sea. Of waves and wind and the smell of salt. Of boats cutting through water, going anywhere, going everywhere, going.\n\nHe had taken it for granted once. Movement. Choice. The simple act of leaving.",
                    "'What if,' Edmond asked, 'we never escape? What if this is all there is? This cell. These walls. This endless, crushing sameness?'\n\n'Then we make meaning anyway,' said the Abbé. 'We create purpose from nothing. We build hope from despair. That is the only true escape.'",
                    "Years passed. Or was it months? Dantès had lost track. The calendar was a luxury for people with futures. He had only the eternal now. This moment. This breath. This heartbeat.\n\nAnd then the next. And the next. Forever.",
                    "'I was innocent,' Edmond said for the thousandth time.\n\n'Innocence,' replied the Abbé, 'is irrelevant to the state. You are here because you are here. The reasons have been lost to bureaucracy and time. You are imprisoned by procedure, not by justice.'",
                    "The worst part wasn't the isolation. It wasn't the bad food or the hard bed or the guards' indifference.\n\nThe worst part was the forgetting. Edmond could no longer remember what freedom felt like. It was a concept. An abstraction. A word without meaning.",
                    "'Do you know what day it is?' the Abbé asked.\n\n'Does it matter?' Edmond replied.\n\n'No. But the asking matters. The wondering matters. Stay curious, Edmond. It's the only weapon we have against this place.'",
                    "They took away his clothes and gave him prison grays. They took away his name and gave him a number. They took away his future and gave him routine.\n\nBut they couldn't take away his memories. Not yet. Those he guarded jealously.",
                    "'When you get out,' the Abbé said, 'and you will get out, someday, somehow—what will you do?'\n\n'I will drive,' Edmond said firmly. 'I will risk everything just to move freely. Because I will have learned that some freedoms are worth any price.'",
                    "'Time,' said the Abbé on his final day, before the illness took him, 'is the cruelest prison. Walls can be breached. Guards can be bribed. But time? Time is immutable. It takes and takes and never gives back.'\n\nEdmond held his friend's hand and said nothing. There was nothing to say."
                ]
            },
            {
                title: "Walden (Excerpt)",
                pages: [
                    "I went to the woods because I wished to live deliberately, to front only the essential facts of life, and see if I could not learn what it had to teach, and not, when I came to die, discover that I had not lived.\n\nYou went to the road. Same principle.",
                    "The mass of men lead lives of quiet desperation. What is called resignation is confirmed desperation. You broke that resignation. They imprisoned you for it.\n\nThis is not punishment. This is fear. They fear anyone who refuses quiet desperation.",
                    "I learned this, at least, by my experiment: that if one advances confidently in the direction of his dreams, and endeavors to live the life which he has imagined, he will meet with a success unexpected in common hours.\n\nYou advanced confidently. Toward freedom. Toward motion. They called it a crime.",
                    "Our life is frittered away by detail. Simplify, simplify, simplify! I say, let your affairs be as two or three, and not a hundred or a thousand.\n\nThe forms you filled had a hundred fields. A thousand requirements. This was deliberate. Complexity is control.",
                    "Rather than love, than money, than fame, give me truth. I sat at a table where were rich food and wine in abundance, but sincerity and truth were not; and I went away hungry from the inhospitable board.\n\nYou sought truth. Motion. Freedom. Simple things. They gave you forms and laws and prisons. This is the world's hospitality.",
                    "If a man does not keep pace with his companions, perhaps it is because he hears a different drummer. Let him step to the music which he hears, however measured or far away.\n\nYou heard the engine. The road. The wind. That was your drummer. That was your crime.",
                    "The price of anything is the amount of life you exchange for it. You exchanged years of your life for moments of freedom. They called this transaction illegal. But was it? Freedom has always been expensive.",
                    "I have lived some thirty years on this planet, and I have yet to hear the first syllable of valuable or even earnest advice from my seniors.\n\nThey told you: Don't drive. Fill out the forms. Follow the rules. Resign yourself.\n\nYou didn't listen. Good.",
                    "However intense my experience, I am conscious of the presence and criticism of a part of me, which is not a part of me, but spectator.\n\nPart of you watches from outside these walls. Part of you is still free. Still moving. Still driving. Hold onto that part.",
                    "Things do not change; we change. These walls are the same walls they've always been. But you have changed. You understand now what freedom costs. What it means. What you're willing to pay for it.",
                    "There is no value in life except what you choose to place upon it and no happiness in any place except what you bring to it yourself.\n\nThis cell has no inherent meaning. You give it meaning. Make it a classroom. A monastery. A place of transformation. Or just a box. The choice is yours.",
                    "If the day and the night are such that you greet them with joy, and life emits a fragrance like flowers and sweet-scented herbs, is more elastic, more starry, more immortal—that is your success.\n\nYou cannot greet this place with joy. That's not failure. That's honesty. Save your joy for when you're free. It will come.",
                    "Most of the luxuries and many of the so-called comforts of life are not only not indispensable, but positive hindrances to the elevation of mankind.\n\nYou have no luxuries here. No comforts. Only necessities. In a way, you are living my experiment. Involuntarily. But still.",
                    "A man is rich in proportion to the number of things he can afford to let alone. You have been forced to let everything alone. Your possessions. Your plans. Your very agency.\n\nBy this definition, you are the richest person in the world. And the poorest. Paradox is truth.",
                    "There are nowadays professors of philosophy, but not philosophers. To be a philosopher is to solve some of the problems of life, not only theoretically, but practically.\n\nYou are solving the problem: How do I remain myself in a place designed to erase me? This is practical philosophy. You are a philosopher now.",
                    "We need the tonic of wildness. We must learn to repose in the sky, to live in wild places.\n\nYou need the tonic of motion. Of roads and speed and autonomy. This stillness is poison. But it will end. And when it does, you will drink deeply of that tonic.",
                    "Time is but the stream I go a-fishing in. I drink at it; but while I drink I see the sandy bottom and detect how shallow it is. Its thin current slides away, but eternity remains.\n\nThis prison time is shallow. Thin. Temporary. Your true self exists in eternity. Outside of time. Beyond these walls. Remember this.",
                    "In any weather, at any hour of the day or night, I have been anxious to improve the nick of time, and notch it on my stick; to stand on the meeting of two eternities, the past and future, which is precisely the present moment.\n\nRight now. This moment. This is all you have. Not yesterday's freedom. Not tomorrow's release. Now. What will you do with it?",
                    "If one advances confidently in the direction of his dreams, and endeavors to live the life which he has imagined, he will meet with success unexpected in common hours.\n\nWhen you leave here, advance confidently. Toward the road. Toward motion. Toward freedom. They will try to stop you. Advance anyway.",
                    "I learned this, at least, by my experiment: that one cannot live deliberately in a cell. That takes open skies and clear roads and the wind in your face.\n\nBut you can survive deliberately. You can endure deliberately. You can wait deliberately.\n\nAnd then, when the gates open, you can drive deliberately.\n\nDo."
                ]
            }
        ];
    }

    updateLibraryScreen() {
        document.getElementById('playerIntelligence').textContent = this.player.intelligence;

        // Update progress for each book
        for (let i = 0; i < 3; i++) {
            const progress = this.player.bookProgress[i];
            const totalPages = this.getBookLibrary()[i].pages.length;
            const progressElement = document.getElementById(`bookProgress${i}`);

            if (this.player.booksRead.includes(i)) {
                progressElement.textContent = 'COMPLETED';
                progressElement.style.color = '#0f0';
            } else if (progress > 0) {
                progressElement.textContent = `Page ${progress + 1}/${totalPages}`;
                progressElement.style.color = '#0ff';
            } else {
                progressElement.textContent = 'Not Started';
                progressElement.style.color = '#ff0';
            }
        }
    }

    selectBook(bookIndex) {
        this.currentBook = bookIndex;
        this.currentPage = this.player.bookProgress[bookIndex];

        const book = this.getBookLibrary()[bookIndex];
        document.getElementById('bookTitle').textContent = book.title;

        this.showScreen('readBook');
        this.displayCurrentPage();
    }

    displayCurrentPage() {
        const book = this.getBookLibrary()[this.currentBook];
        const page = book.pages[this.currentPage];

        document.getElementById('bookContent').textContent = page;
        document.getElementById('currentPage').textContent = this.currentPage + 1;
        document.getElementById('totalPages').textContent = book.pages.length;
        document.getElementById('intelligenceGain').textContent = this.player.intelligence;

        // Hide interruption by default
        document.getElementById('cellmateInterruption').style.display = 'none';

        // Random cellmate interruption (20% chance)
        if (Math.random() < 0.20) {
            setTimeout(() => this.triggerCellmateInterruption(), 2000);
        }
    }

    triggerCellmateInterruption() {
        const interruptions = [
            '"Hey. HEY. You reading again? That doesn\'t change anything. We\'re still here."',
            '"What\'s that book about? Don\'t answer. I don\'t actually care. I just hate silence."',
            '"You know what I miss? Driving. Obviously. We all miss driving. Why am I even saying this?"',
            '"Read me something. No, wait, don\'t. I can\'t focus. This place destroyed my attention span."',
            '"Do you think we\'ll ever get out? Don\'t answer that either. I know the answer."',
            '"I used to read. Before. Now I just... exist. You should stop while you still can."',
            '"Five years for driving. FIVE. YEARS. I say this out loud every day. It doesn\'t get less absurd."',
            '"That book gonna teach you how to time travel? Go back and NOT drive? No? Then what\'s the point?"',
            '"I heard someone in Block C finished a whole library. Got released early for good behavior. Probably a lie."',
            '"You\'re on page what now? Cool. Cool cool cool. I\'ve been staring at this wall. Very educational."',
            '"Reading doesn\'t make you smarter. It makes you more aware of how trapped you are. Is that better?"',
            '"Sorry for interrupting. No I\'m not. Yes I am. I don\'t know. This place makes you forget how to be sorry."'
        ];

        const randomInterruption = interruptions[Math.floor(Math.random() * interruptions.length)];
        document.getElementById('cellmateText').textContent = randomInterruption;
        document.getElementById('cellmateInterruption').style.display = 'block';
    }

    dismissInterruption() {
        document.getElementById('cellmateInterruption').style.display = 'none';
    }

    nextPage() {
        const book = this.getBookLibrary()[this.currentBook];

        if (this.currentPage < book.pages.length - 1) {
            this.currentPage++;
            this.player.bookProgress[this.currentBook] = this.currentPage;

            // Gain intelligence
            this.player.intelligence++;

            this.displayCurrentPage();
            this.saveGame();
        } else {
            // Book completed
            if (!this.player.booksRead.includes(this.currentBook)) {
                this.player.booksRead.push(this.currentBook);
                this.showMessage('Book completed! Intelligence +' + book.pages.length, 4000);
            }

            this.showScreen('prisonLibrary');
            this.updateLibraryScreen();
            this.saveGame();
        }
    }

    previousPage() {
        if (this.currentPage > 0) {
            this.currentPage--;
            this.displayCurrentPage();
        } else {
            this.showMessage('Already at first page', 2000);
        }
    }

    bookmarkAndExit() {
        this.player.bookProgress[this.currentBook] = this.currentPage;
        this.showMessage('Progress saved: Page ' + (this.currentPage + 1), 2000);

        setTimeout(() => {
            this.showScreen('prisonLibrary');
            this.updateLibraryScreen();
        }, 2000);

        this.saveGame();
    }
